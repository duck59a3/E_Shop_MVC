@model DashboardVM

@{
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="dashboard-banner mb-4 text-center text-white d-flex align-items-center justify-content-center">
    <h2 class="m-0">Báo cáo tổng quan</h2>
</div>
<!-- KPI Cards -->
<div class="row mb-4 text-center">
    
    <div class="col-md-3">
        <div class="card shadow-sm p-3 bg-info text-white">
            <h5>Tổng số đơn hàng</h5>
            <h3 id="orderCount">@Model.TotalOrders</h3>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card shadow-sm p-3 bg-primary text-white">
            <h5>Khách hàng</h5>
            <h3>@Model.TotalCustomers</h3>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card shadow-sm p-3 bg-warning text-white">
            <h5>Sản phẩm đã bán</h5>
            <h3>@Model.TotalSoldProducts</h3>
        </div>
    </div>
</div>

<!-- Biểu đồ -->
<div class="row mb-4 text-center">
    <div class="col-md-6 mb-4">
        <canvas id="productChart"></canvas>
    </div>
    <div class="col-md-6 mb-4 ">
    <canvas id="topProductChart"></canvas>
</div>
</div>

<div class="row b-4 text-center">
   

    <div class="col-md-6 mb-4">
        <canvas id="topRegion"></canvas>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const connection = new signalR.HubConnectionBuilder()
    .withUrl("/DashboardHub")
    .build();

    connection.start()
        .then(() => console.log("Connected to ReportHub"))
        .catch(err => console.error(err));

        connection.on("UpdateDashboard", data => {
        console.log("Received data:", data);
        document.querySelector("#orderCount").innerText = `${data.allorder}`;
        
        
    });
    // Bar Chart - Sản phẩm
    const productCtx = document.getElementById('productChart').getContext('2d');
    new Chart(productCtx, {
        type: 'bar',
        data: {
            labels: ['Tồn kho', 'Đã bán'],
            datasets: [{
                label: 'Thống kê sản phẩm',
                data: [@Model.TotalProducts, @Model.TotalSoldProducts],
                backgroundColor: ['rgba(54, 162, 235, 0.6)', 'rgba(255, 99, 132, 0.6)']
            }]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    // Pie Chart - Top sản phẩm bán chạy
    const topLabels = @Html.Raw(Json.Serialize(Model.TopProducts.Select(p => p.ProductName)));
    const topData = @Html.Raw(Json.Serialize(Model.TopProducts.Select(p => p.SoldQuantity)));
    const topCtx = document.getElementById('topProductChart').getContext('2d');
    new Chart(topCtx, {
        type: 'pie',
        data: {
            labels: topLabels,
            datasets: [{
                label: 'Top 5 sản phẩm bán chạy',
                data: topData,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.6)',
                    'rgba(54, 162, 235, 0.6)',
                    'rgba(255, 206, 86, 0.6)',
                    'rgba(75, 192, 192, 0.6)',
                    'rgba(153, 102, 255, 0.6)'
                ]
            }]
        },
        options: { responsive: true }
    });

    const topRegionLabels = @Html.Raw(Json.Serialize(Model.TotalOrdersByRegion.Select(r => r.Region)));
    const topRegionData = @Html.Raw(Json.Serialize(Model.TotalOrdersByRegion.Select(r => r.OrderCount)));
    const topRegionCtx = document.getElementById('topRegion').getContext('2d');
    new Chart(topRegionCtx, {
        type: 'bar',
        data: {
            labels: topRegionLabels,
            datasets: [{
                label: 'Thống kê đơn hàng theo khu vực',
                data: topRegionData,
                backgroundColor: 'rgba(255, 159, 64, 0.6)'
            }]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });
</script>
<style>
    .dashboard-banner {
        width: 100%;
        height: 120px; /* độ cao banner */
        background: linear-gradient(90deg, #4e73df, #1cc88a); /* gradient đẹp */
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        font-size: 2rem;
    }
</style>